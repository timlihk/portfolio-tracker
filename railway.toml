[build]
builder = "NIXPACKS"
buildCommand = "npm install --prefix backend && npx --prefix backend prisma generate && npm run build:all"

[deploy]
startCommand = "npx --prefix backend prisma db push --skip-generate && npm --prefix backend run start:prod"

[[services]]
name = "portfolio-tracker"
healthCheckPath = "/api/healthz"

[services.env]
NODE_ENV = "production"
DATABASE_URL = "${DATABASE_URL}"
JWT_SECRET = "${JWT_SECRET}"

[[services.ports]]
port = 8080
protocol = "http"

[[databases]]
name = "mangrove-db"
type = "postgresql"